<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <report id="reporte_sm" string="Reporte de Mantenimiento" model="website.support.ticket" report_type="qweb-pdf" name="website_support.reporte_sm_document"/>
        <template id="reporte_sm_document">
        	<t t-call="report.html_container">
                <t t-call="report.external_layout">
                    <t t-foreach="docs" t-as="o">
                        <div class="page">
                            <table style="width:100%;">
                                <tr>
                                	
                                    <th>
                                        <h3 align="center" style="color:white; background-color:#083464;">Reporte de Mantenimiento
                                            <strong><p align="center" style="color:white; background-color:#083464;" t-esc="o.ticket_number_display"/></strong>
                                        </h3>
                                    </th>
                                </tr>
                            </table>
                            <div class="row">
                                <style>
                                    th, td{
                                    padding: 5px;
                                    }
                                    strong{
                                    font-size:125%
                                    }
                                </style>
                                <table style="width:100%;">
                                    <thead>
                                    	<tr>
                                        	<td>
                                            	<strong><span t-esc="o.subject"/></strong>
                                        	</td>
                                    	</tr>
                                        <td style="width:100%;" colspan="4">
                                            <h4 style="color:#083464;">Detalles</h4>
                                            <hr/>
                                        </td>
                                        <tr>
                                            <th>Granja</th>
                                            <td>
                                                <span t-esc="o.category.name"/>
                                            </td>
                                            <th>Fecha de Solicitud</th>
                                            <td>
                                                <span t-esc="o.fecha_solicitud"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Jefe de Granja</th>
                                            <td>
                                                <span t-esc="o.partner_id.name"/>
                                            </td>
                                            <th>Prioridad</th>
                                            <td>
                                                <span t-esc="o.priority_id.name"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Categoria</th>
                                            <td>
                                                <span t-esc="o.cat_mant_id.name"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Tipo de Mantenimiento</th>
                                            <td>
                                                <span t-esc="o.tipo_mant_id.name"/>
                                            </td>
                                        </tr>
                                        <td style="width:100%; " colspan="4">
                                            <h3 style="color:#083464;">Descripcion</h3>
                                        </td>
                                        <tr>
                                            <td style="width:100%;" colspan="4">
                                                <span t-esc="o.description"/>
                                            </td>
                                        </tr>
                                    </thead>
                                </table>
                                <h3 style="color:white; background-color:#083464; padding: 2px;">Departamento de Mantenimiento</h3>
                                <table style="width:100%">
                                    <tr>
                                        <th>Responsable</th>
                                        <th>Asignada</th>
                                        <th>Prioridad</th>
                                    </tr>
                                    <tr>
                                        <td><span t-field="o.user_id.name"/> </td>
                                        <td><span t-field="o.asignar.name"/> </td>
                                        <td><span t-field="o.prioridad_mant.name"/> </td>
                                    </tr>
                                </table>
                                <h4 style="color:#083464;">Terminacion</h4>
                                <hr/>
                                <table style="width:100%">
                                	<thead>
                                		<tr>
                                			<th>Fecha de Reporte</th>
                                			<td>
                                				<span t-esc="o.fecha_reporte"/>
                                			</td>
                                			<th>Inicio real</th>
                                			<td>
                                				<span t-esc="o.fecha_incio_real"/>
                                			</td>
                                		</tr>
                                		<tr>
                                			<th>Fechas Estimada</th>
                                			<td>
                                				<span t-esc="o.fecha_estimada"/>
                                			</td>
                                			<th>Terminacion Real</th>
                                			<td>
                                				<span t-esc="o.close_time"/>
                                			</td>
                                		</tr>
                                		<td style="width:100%; " colspan="4">
                                			<h3 style="color:#083464;">Nota:</h3>
                                		</td>
                                		<tr>
                                			<td style="width:100%;" colspan="4">
                                				<span t-esc="o.close_comment"/>
                                			</td>
                                		</tr>
                                	</thead>
                                </table>
                                <H4 style="color:#083464;">Evaluacion</H4>
                                <hr/>
                                <table style="width:100%">
                                	<tr>
                                		<th>Calificacion</th>
                                        <th>Comentarios</th>
                                    </tr>
                                    <tr>
                                    	<td>
                                    		<t t-if="o.support_rating == 5">
                                        		<label>
                                            		<img src="/website_support/static/src/img/5-star-eval.png" width="167" height="50"/>
                                        		</label>
                                    		</t>
                                    		<t t-if="o.support_rating == 4">
                                        		<label>
                                            		<img src="/website_support/static/src/img/4-star-eval.png" width="167" height="50"/>
                                        		</label>
                                   			</t>
                                    		<t t-if="o.support_rating == 3">
                                        		<label>
                                            		<img src="/website_support/static/src/img/3-star-eval.png" width="167" height="50"/>
                                        		</label>
                                    		</t>
                                    		<t t-if="o.support_rating == 2">
                                       			<label>
                                            		<img src="/website_support/static/src/img/2-star-eval.png" width="167" height="50"/>
                                        		</label>
                                    		</t>
                                    		<t t-if="o.support_rating == 1">
                                        		<label>
                                            		<img src="/website_support/static/src/img/1-star-eval.png" width="167" height="50"/>
                                        		</label>
                                    		</t>
                                		</td>
                                        <td><span t-field="o.support_comment"/></td>
                                    </tr>
                                </table>
                                <hr/>
                                <h3 style="color:white; background-color:#083464; padding: 2px;">Compras</h3>
                                <t t-foreach="o.compras_ids" t-as="compra">
                                    <t t-foreach="compra.order_line" t-as="lineas">
                                        <table style="width:100%">
                                            <thead>
                                                <tr>
                                	                <th>Pedido</th>
                                                    <th>Proveedor</th>
                                                    <th>Refacciones</th>
                                                    <th>Cantitad</th>
                                                    <th>Costo</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <span t-field="compra.name"/>
                                                    </td>
                                                    <td>
                                                        <span t-field="compra.partner_id.name"/>
                                                    </td>
                                                    <td>
                                                        <span t-field="lineas.product_id.name"/>
                                                    </td>
                                                    <td>
                                                        <span t-field="lineas.product_qty"/>
                                                    </td>
                                                    <td>
                                                        <span t-field="lineas.price_subtotal"/>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </t>
                                </t>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </template>

<!-- Reporte de Mantenimineto Refacciones -->
        <report id="reporte_operacion_rm" string="Reporte de Operacion" model="website.support.ticket" report_type="qweb-pdf" name="website_support.reporte_operacion_sm_document"/>
        <template id="reporte_operacion_sm_document">
            <t t-call="report.html_container">
                <t t-call="report.external_layout">
                    <t t-foreach="docs" t-as="o">
                        <div class="page">
                            <table style="width:100%;">
                                <tr>
                                    
                                    <th>
                                        <h3 align="center" style="color:white; background-color:#083464;">Reporte de Mantenimiento
                                            <strong><p align="center" style="color:white; background-color:#083464;" t-esc="o.ticket_number_display"/></strong>
                                        </h3>
                                    </th>
                                </tr>
                            </table>
                            <div class="row">
                                <style>
                                    th, td{
                                    padding: 5px;
                                    }
                                    strong{
                                    font-size:125%
                                    }
                                </style>
                                <table style="width:100%;">
                                    <thead>
                                        <tr>
                                            <td>
                                                <strong><span t-esc="o.subject"/></strong>
                                            </td>
                                        </tr>
                                        <td style="width:100%;" colspan="4">
                                            <h4 style="color:#083464;">Detalles</h4>
                                            <hr/>
                                        </td>
                                        <tr>
                                            <th>Area</th>
                                            <td><span t-esc="o.category.name"/></td>
                                            <th>Fecha de Solicitud</th>
                                            <td><span t-esc="o.fecha_solicitud"/></td>
                                        </tr>
                                        <tr>
                                            <th>Equipo</th>
                                            <td><span t-esc="o.equipment_id.name"/></td>
                                            <th>Prioridad</th>
                                            <td><span t-esc="o.priority_id.name"/></td>
                                        </tr>
                                        <tr>
                                            <th>Complemento</th>
                                            <td><span t-esc="o.complement_id.name"/></td>
                                        </tr>
                                        <tr>
                                            <th>Gerencia</th>
                                            <td><span t-esc="o.partner_id.name"/></td>                                            
                                        </tr>
                                        <tr>
                                            <th>Categoria</th>
                                            <td><span t-esc="o.cat_mant_id.name"/></td>
                                        </tr>
                                        <tr>
                                            <th>Tipo de Mantenimiento</th>
                                            <td><span t-esc="o.tipo_mant_id.name"/></td>
                                        </tr>
                                        <td style="width:100%; " colspan="4">
                                            <h3 style="color:#083464;">Descripcion</h3>
                                        </td>
                                        <tr>
                                            <td style="width:100%;" colspan="4">
                                                <span t-esc="o.description"/>
                                            </td>
                                        </tr>
                                    </thead>
                                </table>
                                <h3 style="color:white; background-color:#083464; padding: 2px;">Departamento de Mantenimiento</h3>
                                <table style="width:100%">
                                    <tr>
                                        <th>Responsable</th>
                                        <th>Asignada</th>
                                        <th>Prioridad</th>
                                    </tr>
                                    <tr>
                                        <td><span t-field="o.user_id.name"/> </td>
                                        <td><span t-field="o.asignar.name"/> </td>
                                        <td><span t-field="o.prioridad_mant.name"/> </td>
                                    </tr>
                                </table>
                                <h3 style="color:white; background-color:#083464; padding: 2px;">Refacciones</h3>             
                                <table style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>Producto</th>
                                            <th>Cantitad</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="o.refacciones_ids" t-as="refaccion">
                                            <tr>
                                                <td>
                                                    <span t-field="refaccion.product.name"/>
                                                </td>
                                                <td>
                                                    <span t-field="refaccion.quantity"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </template>

<!-- Reporte de Mantenimientos -->
        <record id="paperformat_report" model="report.paperformat">
            <field name="name">US Bank Check</field>
            <field name="default" eval="True"/>
            <field name="format">custom</field>
            <field name="page_height">297</field>
            <field name="page_width">210</field>
            <field name="orientation">Landscape</field>
            <field name="margin_top">3</field>
            <field name="margin_bottom">3</field>
            <field name="margin_left">3</field>
            <field name="margin_right">3</field>
            <field name="header_line" eval="False"/>
            <field name="header_spacing">3</field>
            <field name="dpi">80</field>
        </record>
        <report id="reporte_mantenimiento" string="Bitacora de Mantenimientos" model="website.support.ticket.report" report_type="qweb-pdf" name="website_support.reporte_mantenimiento_document" paperformat="website_support.paperformat_report"/>
        <template id="reporte_mantenimiento_document">
            <t t-call="report.html_container">
                <div class="page">
                    <div style="padding-top:15mm;">
                        <t t-foreach="docs" t-as="o">
                            <table style="width:100%; border: 1px solid black;">
                                <tr style="border: 1px solid black;">
                                    <th class="text-center" style="border: 1px solid black;" rowspan="2"><p>BITACORA DE MANTENIMIENTO<br/>
                                        CONTROL TIEMPO</p></th>
                                    <th class="text-center" style="border: 1px solid black;">FECHA DE EMISION</th>
                                    <th class="text-center" style="border: 1px solid black;">CODIGO</th>
                                    <th class="text-center" style="border: 1px solid black;">VIGENCIA</th>
                                    <td class="text-center" rowspan="4"><img src="/website_support/static/description/altaconversion.png" style="width:100; height:100;"/></td>
                                </tr>
                                <tr style="border: 1px solid black;">
                                    <td align="center" style="border: 1px solid black;"><span t-esc="o.fecha"/></td>
                                    <td align="center" style="border: 1px solid black;"></td>
                                    <td align="center" style="border: 1px solid black;"></td>
                                </tr>
                                <tr style="border: 1px solid black;">
                                    <th class="text-center" style="border: 1px solid black;">PROPIETARIO</th>
                                    <th class="text-center" style="border: 1px solid black;">PAGINAS</th>
                                    <th class="text-center" style="border: 1px solid black;">VERSION</th>
                                    <th class="text-center" style="border: 1px solid black;">REVISION</th>
                                </tr>
                                <tr style="border: 1px solid black;">
                                    <td style="border: 1px solid black;"></td>
                                    <td style="border: 1px solid black;"></td>
                                    <td style="border: 1px solid black;"></td>
                                    <td style="border: 1px solid black;"></td>
                                </tr>
                            </table>
                            <br/>
                            <table style="width:100%; border: 1px solid black;">
                                <tr style="border: 1px solid black;">
                                    <th style="border: 1px solid black;" class="text-center">FECHA</th>
                                    <th style="border: 1px solid black;" class="text-center">TIPO DE MANTENIMIENTO</th>
                                    <th style="border: 1px solid black;" class="text-center">DESCRIPCION</th>
                                    <th style="border: 1px solid black;" class="text-center">EQUIPO</th>
                                    <th style="border: 1px solid black;" class="text-center">AREA</th>
                                    <th style="border: 1px solid black;" class="text-center">TIEMPO DE MANTENIMIENTO</th>
                                    <th style="border: 1px solid black;" class="text-center">TIEMPO UTILIZADO</th>
                                    <th style="border: 1px solid black;" class="text-center">RESPONSABLE</th>
                                </tr>
                                <t t-foreach="o.reportes" t-as="r">
                                    <tr style="border: 1px solid black;">
                                        <td style="border: 1px solid black;" align="center"><span t-field="r.fecha_solicitud"/></td>
                                        <td style="border: 1px solid black;" align="center"><span t-field="r.tipo_mant_id.name"/></td>
                                        <td style="border: 1px solid black;" align="center"><span t-field="r.description"/></td>
                                        <td style="border: 1px solid black;" align="center"><span t-field="r.equipment_id.name"/></td>
                                        <td style="border: 1px solid black;" align="center"><span t-field="r.category.name"/></td>
                                        <td style="border: 1px solid black;" align="center"><span t-field="r.time_to_close_est"/> dias</td>
                                        <td style="border: 1px solid black;" align="center"><span t-field="r.time_to_close"/> dias</td>
                                        <td style="border: 1px solid black;" align="center"><span t-field="r.user_id.name"/></td>
                                    </tr>
                                </t>
                            </table>
                            <br/>
                            <br/>
                            <br/>
                            <table style="width:100%">
                                <tr>
                                    <td align="center" style="width:30%">
                                        <p>_________________________________<br/>MANTENIMIENTO</p>
                                    </td>
                                    <td align="center" style="width:30%">
                                        <p>_________________________________<br/>PRODUCCION</p>
                                    </td>
                                    <td align="center" style="width:30%">
                                        <p>_________________________________<br/>GERENCIA</p>
                                    </td>
                                </tr>
                            </table>
                        </t>
                    </div>
                </div>
            </t>
        </template>

        <record id="action_reporte_mantenimientos" model="ir.ui.view">
            <field name="name">Reporte Mantenimiento</field>
            <field name="model">website.support.ticket.report</field>
            <field name="arch" type="xml">
                <form string="Bitacora">
                    <separator colspan="4" string="Bitacora"/>
                    <group>
                        <group>
                            <field name="fecha"/>
                        </group>
                        <group>
                            <field name="codigo"/>
                        </group>
                    </group>
                    <group colspan="2">
                        <notebook>
                            <page string="Reportes">
                                <field name="reportes" readonly="1">
                                    <tree>
                                        <field name="fecha_solicitud"/>
                                        <field name="tipo_mant_id"/>
                                        <field name="description"/>
                                        <field name="equipment_id"/>
                                        <field name="category"/>
                                        <field name="time_to_close_est"/>
                                        <field name="time_to_close"/>
                                        <field name="user_id"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </group>
                    <footer>
                        <button string="Imprimir Reporte" type="object" class="oe_highlight" name="imprimir"/>
                        <button class="oe_link" special="cancel" string="Cerrar"/>
                    </footer>
                </form>
            </field>
        </record>
        <act_window id="action_mantenimientos_reporte" key2="client_action_multi" name="Reporte de Mantenimientos" res_model="website.support.ticket.report" src_model="website.support.ticket" target="new" view_mode="form"/>
    </data>
</odoo>